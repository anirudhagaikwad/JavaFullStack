<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Employee Management</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 font-sans">
    <div class="container mx-auto p-4">
        <h1 class="text-3xl font-bold mb-6 text-center">Employee Management</h1>

        <!-- Employee Form -->
        <div class="bg-white p-6 rounded-lg shadow-md mb-6">
            <h2 class="text-xl font-semibold mb-4">Add/Edit Employee</h2>
            <form id="employeeForm" class="space-y-4">
                <input type="hidden" id="employeeId">
                <div>
                    <label for="empName" class="block text-sm font-medium text-gray-700">Name</label>
                    <input type="text" id="empName" class="mt-1 p-2 w-full border rounded-md" required>
                </div>
                <div>
                    <label for="empEmail" class="block text-sm font-medium text-gray-700">Email</label>
                    <input type="email" id="empEmail" class="mt-1 p-2 w-full border rounded-md" required>
                </div>
                <div>
                    <label for="sal" class="block text-sm font-medium text-gray-700">Salary</label>
                    <input type="number" id="sal" class="mt-1 p-2 w-full border rounded-md" required>
                </div>
                <button type="submit" id="submitBtn" class="bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600">Add Employee</button>
                <button type="button" id="resetBtn" class="bg-gray-500 text-white px-4 py-2 rounded-md hover:bg-gray-600" onclick="resetForm()">Reset</button>
            </form>
        </div>

        <!-- Employee List -->
        <div class="bg-white p-6 rounded-lg shadow-md">
            <h2 class="text-xl font-semibold mb-4">Employee List</h2>
            <table class="w-full table-auto">
                <thead>
                    <tr class="bg-gray-200">
                        <th class="px-4 py-2">ID</th>
                        <th class="px-4 py-2">Name</th>
                        <th class="px-4 py-2">Email</th>
                        <th class="px-4 py-2">Salary</th>
                        <th class="px-4 py-2">Actions</th>
                    </tr>
                </thead>
                <tbody id="employeeTableBody"></tbody>
            </table>
        </div>
    </div>

    <script>
        const API_URL = 'http://localhost:8082/api/employees';

        // Fetch and display all employees
        async function fetchEmployees() {
            try {
                const response = await fetch(API_URL);
                if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);
                const employees = await response.json();
                const tableBody = document.getElementById('employeeTableBody');
                tableBody.innerHTML = '';
                employees.forEach(employee => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td class="border px-4 py-2">${employee.empId || 'N/A'}</td>
                        <td class="border px-4 py-2">${employee.empName || 'N/A'}</td>
                        <td class="border px-4 py-2">${employee.empEmail || 'N/A'}</td>
                        <td class="border px-4 py-2">${employee.sal || 'N/A'}</td>
                        <td class="border px-4 py-2">
                            <button class="bg-yellow-500 text-white px-2 py-1 rounded hover:bg-yellow-600" onclick="editEmployee(${employee.empId})">Edit</button>
                            <button class="bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600" onclick="deleteEmployee(${employee.empId})">Delete</button>
                        </td>
                    `;
                    tableBody.appendChild(row);
                });
            } catch (error) {
                console.error('Error fetching employees:', error);
                alert('Failed to fetch employees: ' + error.message);
            }
        }

        // Reset form
        function resetForm() {
            document.getElementById('employeeForm').reset();
            document.getElementById('employeeId').value = '';
            document.getElementById('submitBtn').textContent = 'Add Employee';
        }

        // Handle form submission
        document.getElementById('employeeForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const id = document.getElementById('employeeId').value;
            const employee = {
                empName: document.getElementById('empName').value,
                empEmail: document.getElementById('empEmail').value,
                sal: parseFloat(document.getElementById('sal').value)
            };

            try {
                if (id) {
                    // Update existing employee
                    const response = await fetch(`${API_URL}/update/${id}`, {
                        method: 'PUT',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(employee)
                    });
                    if (!response.ok) throw new Error(`Failed to update employee: ${response.status}`);
                } else {
                    // Add new employee
                    const response = await fetch(`${API_URL}/register`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(employee)
                    });
                    if (!response.ok) throw new Error(`Failed to add employee: ${response.status}`);
                }
                resetForm();
                fetchEmployees();
            } catch (error) {
                console.error('Error saving employee:', error);
                alert('Failed to save employee: ' + error.message);
            }
        });

        // Edit employee
        async function editEmployee(empId) {
            try {
                const response = await fetch(`${API_URL}/${empId}`);
                if (!response.ok) throw new Error(`Employee not found: ${response.status}`);
                const employee = await response.json();
                document.getElementById('employeeId').value = employee.empId;
                document.getElementById('empName').value = employee.empName;
                document.getElementById('empEmail').value = employee.empEmail;
                document.getElementById('sal').value = employee.sal;
                document.getElementById('submitBtn').textContent = 'Update Employee';
            } catch (error) {
                console.error('Error fetching employee:', error);
                alert('Failed to fetch employee: ' + error.message);
            }
        }

        // Delete employee
        async function deleteEmployee(empId) {
            if (confirm('Are you sure you want to delete this employee?')) {
                try {
                    const response = await fetch(`${API_URL}/delete/${empId}`, {
                        method: 'DELETE'
                    });
                    if (!response.ok) throw new Error(`Failed to delete employee: ${response.status}`);
                    fetchEmployees();
                } catch (error) {
                    console.error('Error deleting employee:', error);
                    alert('Failed to delete employee: ' + error.message);
                }
            }
        }

        // Initial fetch
        fetchEmployees();
    </script>
</body>
</html>

<!-- 
1. Configure CORS in Spring Boot:
   - Add `@CrossOrigin(origins = "http://localhost:5500", methods = {RequestMethod.GET, RequestMethod.POST, RequestMethod.PUT, RequestMethod.DELETE})` to `EmployeeRestController` class.
   - Alternatively, create a `WebConfig` class with:
     ```java
     @Configuration
     public class WebConfig implements WebMvcConfigurer {
         @Override
         public void addCorsMappings(CorsRegistry registry) {
             registry.addMapping("/**")
                     .allowedOrigins("http://localhost:5500")
                     .allowedMethods("GET", "POST", "PUT", "DELETE", "OPTIONS")
                     .allowedHeaders("*")
                     .allowCredentials(true);
         }
     }
     ```

2. Start PostgreSQL:
   - Ensure PostgreSQL is installed.
   - Start the PostgreSQL service:
     - On Windows: Use Services app or `pg_ctl -D "C:\path\to\data" start`.
     - On Linux/Mac: Run `sudo service postgresql start` or `pg_ctl -D /path/to/data start`.
   - Verify connection using `psql -U postgres` and check database is running.
   - Configure `application.properties` in Spring Boot:
     ```properties
     spring.datasource.url=jdbc:postgresql://localhost:5432/your_database
     spring.datasource.username=postgres
     spring.datasource.password=your_password
     spring.jpa.hibernate.ddl-auto=update
     ```

3. Run Python HTTP Server:
   - Navigate to the frontend directory containing `index.html`:
     ```bash
     cd employee-crud-frontend
     ```
   - Start the server:
     ```bash
     python3 -m http.server 5500
     ```

4. Start Browser and Access Application:
   - Open a browser and navigate to `http://localhost:5500/index.html`.

-->